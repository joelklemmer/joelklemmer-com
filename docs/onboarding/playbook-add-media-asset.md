# Playbook — Add media asset

Add a new media asset: master file, manifest entry, derivatives (thumb/card/hero as required), and alt text. Governed by media-manifest, media-derivatives, media-authority, and media-governance validators.

## 1. File naming and location

- **Naming:** `joel-klemmer__<kind>__<descriptor>__YYYY-MM__NN.webp`. kind: `portrait` | `author` | `identity` | `speaking`. descriptor: lowercase, hyphenated. No variant suffix on the master file.
- **Location:** Master under `apps/web/public/media/<kind>/` (or the path your manifest and ingest tooling use). Manifest `file` field must reference the master only (no `__thumb` or `__hero`).

**Reference:** [docs/media-governance.md](../media-governance.md).

---

## 2. Create or update the manifest

- **Manifest:** Typically `apps/web/public/media/manifest.json` or the path returned by `getMediaManifest()` from `@joelklemmer/content` (see `libs/content/src/lib/media.ts` for schema).
- **Required fields per asset:** id, file (master path), kind, descriptor, recommendedUse (array), aspectRatio, width, height, sha256, alt. Optional: authorityTier ('A'|'B'|'C'), personaSignal, environmentSignal, formalityLevel, visualTone, caption, seoKeywords, etc.
- **alt:** Non-empty, descriptive. No placeholders: "image", "photo", "picture", "placeholder", "todo" fail media-governance-validate. Prefer one alt per distinct scene/subject.

**Commands:**

```bash
nx run web:media-manifest-validate
nx run web:media-governance-validate
```

**Expected output:** Pass messages; governance reports “Media governance validation passed: N assets (alt doctrine, filenames, master-only).”

**Failure:** Schema error (missing field), file not found, or alt/filename violation. **Corrective action:** Add missing fields; ensure file exists at the path in `file`; fix alt and ensure manifest `file` has no variant suffix.

---

## 3. Derivatives (thumb / card / hero)

- **Rules:** Tier A visible assets need thumb (and hero/card when in recommendedUse). See `tools/validate-media-derivatives.ts` and [docs/media-governance.md](../media-governance.md).
- **Suffixes:** `__thumb.webp`, `__card.webp`, `__hero.webp` alongside the master. Generated by ingest/derivative pipeline (e.g. `tools/ingest-media.ts` or similar); do not point manifest at these.

**Commands:**

```bash
nx run web:media-derivatives-validate
```

**Expected output:** Pass. **Failure:** Missing derivative file. **Corrective action:** Run the derivative pipeline for the new asset or add the variant files; ensure Tier and recommendedUse match validator expectations.

---

## 4. Authority tier and signals

- **Tier:** A = authority core (visible, indexable); B = indexable, not featured; C = excluded from manifest/sitemap. Tier C must not be sitemap-eligible. Set authorityTier in manifest.
- **Signals:** Optional but validated for structure (personaSignal, environmentSignal, etc.) where required. See `libs/content/src/lib/media.ts` schemas.

**Commands:**

```bash
nx run web:media-authority-validate
```

**Expected output:** Pass. **Failure:** Tier C in sitemap or authority rule violation. **Corrective action:** Set correct authorityTier; fix signals per schema.

---

## 5. Use in the app (optional)

- **Hero/portrait:** Use the path and i18n alt key in the component (e.g. HomeScreen, PortraitImage). Alt from manifest or from messages via key.
- **Media library:** Uses `getMediaManifest()` and thumb derivative for list; ensure asset is in the visible set (Tier A/B and not excluded by your filtering).

**Commands:** Build and manual check.

```bash
nx run web:build
```

---

## Verify targets to run

```bash
nx run web:media-manifest-validate
nx run web:media-derivatives-validate
nx run web:media-authority-validate
nx run web:media-governance-validate
nx run web:verify
```

---

## Documentation updates required

- **New recommendedUse or kind:** Update schema in `libs/content/src/lib/media.ts` if you extend enums; document in [docs/media-governance.md](../media-governance.md) and [docs/media-publishing-checklist.md](../media-publishing-checklist.md).
- **Ingest/derivative pipeline:** If you changed how derivatives are produced, document in tooling or [docs/media-governance.md](../media-governance.md) section 7 (Workflows).
